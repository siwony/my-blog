<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ page.title | default: site.title }}</title>
    
    <!-- Favicon - 검색 봇 및 다양한 브라우저 지원 -->
    <link rel="icon" href="{{ '/assets/images/favicon.svg' | relative_url }}" type="image/svg+xml">
    <link rel="icon" href="{{ '/assets/images/favicon.svg' | relative_url }}" sizes="any" type="image/svg+xml">
    <link rel="apple-touch-icon" href="{{ '/assets/images/favicon.svg' | relative_url }}">
    <link rel="shortcut icon" href="{{ '/assets/images/favicon.svg' | relative_url }}">
    
    <!-- SEO 및 Open Graph 메타태그 -->
    {% seo %}
    <meta name="naver-site-verification" content="536487f99d146854fb1184fa37d9b5ef04d57721" />
    
    <!-- Critical CSS (인라인) - LCP/FCP 최적화 -->
    <style>{% include critical.css %}</style>
    
    <!-- Font Preloading -->
    <link rel="preload" href="{{ '/assets/fonts/inter-latin-400.woff2' | relative_url }}" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="{{ '/assets/fonts/inter-latin-600.woff2' | relative_url }}" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="{{ '/assets/fonts/Pretendard-Regular.subset.woff2' | relative_url }}" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="{{ '/assets/fonts/Pretendard-SemiBold.subset.woff2' | relative_url }}" as="font" type="font/woff2" crossorigin>
    
    <!-- Common CSS - Loaded on all pages -->
    <link rel="stylesheet" href="{{ '/assets/css/common.css' | relative_url }}">
    
    <!-- Page-specific CSS (Conditional loading) -->
    {% if page.layout == 'post' %}
    <link rel="stylesheet" href="{{ '/assets/css/post.css' | relative_url }}">
    {% elsif page.layout == 'category' %}
    <link rel="stylesheet" href="{{ '/assets/css/category.css' | relative_url }}">
    {% else %}
    <link rel="stylesheet" href="{{ '/assets/css/home.css' | relative_url }}">
    {% endif %}
    
    <!-- Prism.js CSS (지연 로딩 - 코드 블록용) -->
    <link rel="stylesheet" href="{{ '/assets/css/prism/prism-material-theme.css' | relative_url }}" media="print" onload="this.media='all'">
    <link rel="stylesheet" href="{{ '/assets/css/prism/prism-toolbar.min.css' | relative_url }}" media="print" onload="this.media='all'">
    <link rel="stylesheet" href="{{ '/assets/css/prism/prism-line-numbers.min.css' | relative_url }}" media="print" onload="this.media='all'">
    <noscript>
        <link rel="stylesheet" href="{{ '/assets/css/prism/prism-material-theme.css' | relative_url }}">
        <link rel="stylesheet" href="{{ '/assets/css/prism/prism-toolbar.min.css' | relative_url }}">
        <link rel="stylesheet" href="{{ '/assets/css/prism/prism-line-numbers.min.css' | relative_url }}">
    </noscript>

    <!-- PhotoSwipe CSS (지연 로딩 - 이미지 뷰어용) -->
    <link rel="stylesheet" href="{{ '/assets/css/photoswipe/photoswipe.css' | relative_url }}" media="print" onload="this.media='all'">
    <noscript><link rel="stylesheet" href="{{ '/assets/css/photoswipe/photoswipe.css' | relative_url }}"></noscript>
    
    <!-- GitHub Markdown Table Styles (지연 로딩) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/5.4.0/github-markdown-light.min.css" media="print" onload="this.media='all'">
    <noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/5.4.0/github-markdown-light.min.css"></noscript>

    <!-- Ninja Keys (로컬 번들 - 체인 요청 최적화) -->
    <script src="{{ '/assets/js/ninja-keys.bundle.min.js' | relative_url }}" defer></script>
</head>
<body>
    <div class="site-wrapper">
        <!-- Site Header -->
        <header class="site-header">
            <div class="header-inner">
                <a href="{{ '/' | relative_url }}" class="site-logo">
                    <span>{{ site.title }}</span>
                </a>
                <nav class="site-nav">
                    <ul>
                        <li><a href="{{ '/' | relative_url }}"{% if page.url == '/' %} class="active"{% endif %}>Home</a></li>
                        <li><a href="{{ '/blog/' | relative_url }}"{% if page.url contains '/blog' %} class="active"{% endif %}>Blog</a></li>
                    </ul>
                </nav>
            </div>
        </header>

        <main class="container">
            {{ content }}
        </main>
        
        <!-- Site Footer -->
        {% include footer.html %}
    </div>

    <!-- Prism.js Bundle (단일 파일로 번들링됨, defer로 비차단) -->
    <script src="{{ '/assets/js/prism/prism.bundle.min.js' | relative_url }}" defer></script>

    <!-- Prism.js 초기화 스크립트 -->
    <script defer>
        document.addEventListener('DOMContentLoaded', function() {
            // autoloader 경로 설정 (로컬 컴포넌트 사용)
            if (typeof Prism !== 'undefined' && Prism.plugins && Prism.plugins.autoloader) {
                Prism.plugins.autoloader.languages_path = '{{ "/assets/js/prism/components/" | relative_url }}';
            }
            
            // 모든 pre 태그에 toolbar와 line-numbers 클래스 추가
            document.querySelectorAll('pre[class*="language-"]').forEach(function(pre) {
                pre.classList.add('line-numbers');
            });
            
            // Prism 하이라이팅 재실행
            if (typeof Prism !== 'undefined') {
                Prism.highlightAll();
            }
        });
    </script>
    
    <!-- Command Palette (Ninja Keys) -->
    <script src="{{ '/assets/js/command-palette.js' | relative_url }}" defer></script>
    
    <!-- Category Sidebar Web Component -->
    <script src="{{ '/assets/js/category-sidebar.js' | relative_url }}" defer></script>
    
    <!-- Post Metadata Web Component -->
    <script src="{{ '/assets/js/post-metadata.js' | relative_url }}" defer></script>
    
    <!-- PhotoSwipe Image Viewer (번들링됨 - request chaining 제거) -->
    <script src="{{ '/assets/js/photoswipe.bundle.min.js' | relative_url }}" defer></script>
    <script src="{{ '/assets/js/image-viewer.js' | relative_url }}" defer></script>
    
    <!-- Heading Anchor Links -->
    <script src="{{ '/assets/js/heading-anchors.js' | relative_url }}" defer></script>
    
    <!-- GitHub Table Enhancer -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Add GitHub markdown classes to existing tables
            const tables = document.querySelectorAll('.post-content table, .content table, article table');
            tables.forEach(table => {
                // Wrap table for better styling
                if (!table.parentElement.classList.contains('markdown-body')) {
                    const wrapper = document.createElement('div');
                    wrapper.className = 'markdown-body';
                    table.parentNode.insertBefore(wrapper, table);
                    wrapper.appendChild(table);
                }
            });
        });
    </script>
</body>
</html>
