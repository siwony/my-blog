---
author: jeongcool
categories: devops
date: '2025-03-20'
layout: post
tags:
- scouter
- monitoring
- apm
title: "scouter 설정"
description: "APM 도구인 Scouter를 서버 모니터링을 위해 최적화하여 구성하는 2025년 기준 가이드"
---
내가 생각하는 2025-03월 기준 최적인 scouter 구성

# 각 컴포넌트 버전

- Collector Server : 2.20.0
- agent.host: 2.7.1
    
    → 2.7.1 이후 버전부터 디스크 데이터가 잘 표시되지 않는 현상이 있어 2.7.1로 결정함
    
- agent.java: 2.20.0
- webapp: 2.20.0

# Scouter collection server conf

```bash
log_service_handler_list=true
net_bind=0.0.0.0

# 저장소 자동 삭제 동작 여부
mgr_purge_enabled=true

#프로파일 데이터를 자동으로 지우는 디스크 사용량(%)
mgr_purge_disk_usage_pct=80

#프로파일 데이터가 자동으로 지워지기 전에 유지되는 날짜 수
mgr_purge_profile_keep_days=10

#xlog 정의 데이터가 자동으로 지워지기 전에 유지되는 날짜 수
mgr_purge_xlog_keep_days=30

#각종 카운터(선 그래프의 값)가 자동으로 지워지기 전에 유지되는 날짜 수
mgr_purge_counter_keep_days=70
```

# 각 컴포넌트 서비스 등록

## host.agent

### host.sh

```bash
#!/usr/bin/env bash

java -classpath ./scouter.host.jar scouter.boot.Boot ./lib # java 17 권장
```

### scouterhost.service

```bash
[Unit]
Description=Scouter host agent service
After=network.target

[Service]
Type=simple
WorkingDirectory=/app/scouter/agent.host
ExecStart=/app/scouter/agent.host/host.sh
Restart=always
User=tomadm
Group=tomadm

[Install]
WantedBy=multi-user.target
```

```bash
sudo systemctl enable scouterhost.service
sudo systemctl start scouterhost.service
sudo systemctl sleep 1
sudo systemctl status scouterhost.service
```

## collector server

### startup.sh

```bash
#!/usr/bin/env bash

/usr/lib/jvm/jre-1.8.0/bin/java -Xmx4096m -classpath ./scouter-server-boot.jar scouter.boot.Boot ./lib
```

### scoutercollector.service

```bash
[Unit]
Description=Scouter collector server service
After=network.target

[Service]
Type=simple
WorkingDirectory=/app/scouter/server
ExecStart=/app/scouter/server/startup.sh
Restart=always
User=tomadm
Group=tomadm

[Install]
WantedBy=multi-user.target
```

```bash
sudo systemctl enable scoutercollector.service
sudo systemctl start scoutercollector.service
sudo systemctl sleep 1
sudo systemctl status scouterwebapp.service
```

## scouter webapp

```bash
[Unit]
Description=Scouter webapp service
After=network.target

[Service]
Type=simple
WorkingDirectory=/app/scouter/webapp
ExecStart=/app/scouter/webapp/startup.sh
Restart=always
User=tomadm
Group=tomadm

[Install]
WantedBy=multi-user.target
```

### startup.sh

```bash
#!/usr/bin/env bash
#export JDK_JAVA_OPTIONS="--add-modules java.xml.bind"
/usr/lib/jvm/jre-1.8.0/bin/java -cp ./scouter.webapp.jar:./lib/*:.  scouterx.webapp.main.WebAppMain
```

```bash
sudo systemctl enable scouterwebapp.service
sudo systemctl start scouterwebapp.service
sudo systemctl sleep 1
sudo systemctl status scouterwebapp.service
```

## scouter host agent (FTP)

## host.agent

### host.sh

```bash
#!/usr/bin/env bash

java -classpath ./scouter.host.jar scouter.boot.Boot ./lib # java 17 권장
```

### scouterhost.service

```bash
[Unit]
Description=Scouter host agent service
After=network.target

[Service]
Type=simple
WorkingDirectory=/app/scouter/agent.host
ExecStart=/app/scouter/agent.host/host.sh
Restart=always
User=root
Group=root

[Install]
WantedBy=multi-user.target

```

```bash
sudo systemctl enable scouterhost.service
sudo systemctl start scouterhost.service
sleep 1
sudo systemctl status scouterhost.service
```
