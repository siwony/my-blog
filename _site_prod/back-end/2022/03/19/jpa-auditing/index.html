<!DOCTYPE html><html lang="ko"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>JPA Auditing</title><link rel="stylesheet" href="/assets/css/prism/prism-material-theme.css"><link rel="stylesheet" href="/assets/css/prism/prism-toolbar.min.css"><link rel="stylesheet" href="/assets/css/prism/prism-line-numbers.min.css"><link rel="stylesheet" href="/assets/css/style.css"><script type="module" src="https://unpkg.com/ninja-keys?module"></script></head><body><div class="container"><header><h1><a href="/">My Tech Blog</a></h1><nav><ul><li><a href="/">Home</a></li></ul></nav></header><main><article class="post"><header class="post-header"><h1 class="post-title">JPA Auditing</h1><post-metadata layout="inline" categories='["back-end"]' tags='["spring","jpa","TIL"]' date="March 19, 2022" reading-time="2" compact="false"></post-metadata><div class="post-author"><span class="author-label">작성자:</span> <span class="author-name">jeongcool</span></div></header><div class="post-content"><h1 id="jpa-auditing">JPA Auditing</h1><h3 id="사용동기">사용동기</h3><blockquote><p>MembershipApi를 만들면서 유저 가입일을 추가해보고싶었다.</p></blockquote><h3 id="auditing-활성화">Auditing 활성화</h3><p>자신의 SpringBoot Application class에 <code>@EnableJpaAuditing</code>를 추가한다.</p><pre><code class="language-java">@EnableJpaAuditing //추가한것
@SpringBootApplication
public class Aouth2Application {

	public static void main(String[] args) {
		SpringApplication.run(Aouth2Application.class, args);
	}
}
</code></pre><h3 id="jpa-auditing으로-생성시간수정시간-자동화">JPA Auditing으로 생성시간/수정시간 자동화</h3><pre><code class="language-java">@Getter
@MappedSuperclass
@EntityListeners(AuditingEntityListener.class)
public abstract class BaseTimeEntity {
    @CreatedDate
    private LocalDateTime createdDate;

    @LastModifiedDate
    private LocalDateTime modifiedDate;
}
</code></pre><p><code>BaseTimeEntity</code> 클래스를 만들어 모든 Entity의 상위 클래스가 되어<br><strong>Entity 들의 createDate, modifiedDate를 자동으로 관리하는 역활</strong></p><ul><li><code>@Getter</code> : lombok이 해당 필드에 대한 기본 Getter를 생성해준다.</li><li><code>@MappedSuperclass</code> : JPA Entity 클래스들이 <code>BaseTimeEntity</code>를 상속할 경우<br>필드들(createdDate, modifiedDate)도 칼럼으로 인식하도록 한다.</li><li><code>@CreatedDate</code>: Entity가 생성되어 저장될 때 시간이 자동 저장된다.</li><li><code>@LastModifiedDate</code> : 조회한 Entity의 값이 변경할 때 시간이 자동저장된다</li></ul><h2 id="내-프로젝트에-적용">내 프로젝트에 적용</h2><h3 id="userentity">UserEntity</h3><pre><code class="language-java">@Entity
@Table(name = "user")
@Getter
@Builder
@AllArgsConstructor
@NoArgsConstructor
public class User extends BaseTimeEntity{

    @JsonIgnore
    @Id
    @Column(name = "user_id")
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long userId;

    @Column(name = "username", length = 50, unique = true)
    private String username;

    @JsonIgnore
    @Column(name = "password", length = 100)
    private String password;

    @Column(name = "nickname", length = 50)
    private String nickname;

    @JsonIgnore
    @Column(name = "activated")
    private boolean activated;

    @ManyToMany
    @JoinTable(
            name = "user_authority",
            joinColumns = {@JoinColumn(name = "user_id", referencedColumnName = "user_id")},
            inverseJoinColumns = {@JoinColumn(name = "authority_name", referencedColumnName = "authority_name")})
    private Set&lt;Authority&gt; authorities;
}
</code></pre><p>유저의 기본적인 정보들이 담겨져 있는 User Entity 이다.<br>미리 구현해놓은 singup API 를 사용하여 유저를 생성하면<br><img width="500" src="/assets/images/posts/back-end/signup-API-postman.png"><br>만들어진 시간과 수정시간이 정상적으로 데이터베이스에 입력이 되었다.<br>(singup api는 DB에 저장된 값을 리턴해준다.)</p></div><footer class="post-footer"><div class="post-navigation"><div class="nav-previous"><span class="nav-label">이전 글</span> <a href="/back-end/2022/03/19/java-ee-java-enterprise-edition/" class="nav-link">JAVA EE (Java Enterprise Edition)</a></div><div class="nav-next"><span class="nav-label">다음 글</span> <a href="/back-end/2022/03/19/jpajava-persistence-api/" class="nav-link">JPA(Java Persistence API)</a></div></div></footer></article></main></div><script src="/assets/js/prism/prism.min.js"></script><script src="/assets/js/prism/prism-autoloader.min.js"></script><script src="/assets/js/prism/prism-toolbar.min.js"></script><script src="/assets/js/prism/prism-copy-to-clipboard.min.js"></script><script src="/assets/js/prism/prism-show-language.min.js"></script><script src="/assets/js/prism/prism-line-numbers.min.js"></script><script>document.addEventListener("DOMContentLoaded",function(){Prism.plugins&&Prism.plugins.autoloader&&(Prism.plugins.autoloader.languages_path="/assets/js/prism/components/",console.log("Prism autoloader configured with local path:",Prism.plugins.autoloader.languages_path)),document.querySelectorAll('pre[class*="language-"]').forEach(function(s){s.classList.add("line-numbers")}),Prism.highlightAll()})</script><script src="/assets/js/command-palette.js"></script><script src="/assets/js/category-sidebar.js"></script><script src="/assets/js/post-metadata.js"></script></body></html>