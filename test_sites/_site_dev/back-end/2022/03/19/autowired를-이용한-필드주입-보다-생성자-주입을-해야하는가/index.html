<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@Autowired를 이용한 필드주입 보다 생성자 주입을 해야하는가?</title>
    
    <!-- Prism.js CSS 먼저 로드 -->
    <link rel="stylesheet" href="/assets/css/prism/prism-material-theme.css">
    <link rel="stylesheet" href="/assets/css/prism/prism-toolbar.min.css">
    <link rel="stylesheet" href="/assets/css/prism/prism-line-numbers.min.css">

    <!-- 사이트 CSS -->
    <link rel="stylesheet" href="/assets/css/style.css">

    <!-- Ninja Keys CSS -->
    <script type="module" src="https://unpkg.com/ninja-keys?module"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1><a href="/">My Tech Blog</a></h1>
            <nav>
                <ul>
                    <li><a href="/">Home</a></li>
                </ul>
            </nav>
        </header>

        <main>
            <article class="post">
    <header class="post-header">
        <h1 class="post-title">@Autowired를 이용한 필드주입 보다 생성자 주입을 해야하는가?</h1>
        
        <!-- Enhanced metadata using post-metadata component -->
        <post-metadata 
          layout="inline"
          categories='["back-end"]'
          tags='["spring","TIL"]'
          date="March 19, 2022"
          reading-time="2"
          compact="false">
        </post-metadata>
        
        
        <div class="post-author">
          <span class="author-label">작성자:</span>
          <span class="author-name">jeongcool</span>
        </div>
        
    </header>

    <div class="post-content">
        <h1 id="autowired를-이용한-필드주입-보다-생성자-주입을-해야하는가">@Autowired를 이용한 필드주입 보다 생성자 주입을 해야하는가?</h1>
<h3 id="요약">요약</h3>
<ul>
  <li><a href="#순환참조-오류의-방지"><strong>순환참조 오류의 방지</strong></a>
    <ul>
      <li>순환 참조가 발생하는 경우 애플리케이션이 구동되지 않는다.</li>
    </ul>
  </li>
  <li><strong>테스트 코드 작성의 편리</strong>
    <ul>
      <li>단순 POJO를 이용한 테스트 코드를 만들 수 있다.
        <blockquote>
          <p>필드 주입은 Spring DI container없이 의존성을 넣어 줄 방법이 없다. <del>(리플렉션 쓰면 가능 할 수도?</del></p>
        </blockquote>
      </li>
      <li>필수 의존성을 명시할 수 있다.</li>
    </ul>
  </li>
  <li><strong>좀더 좋은코드를 작성할 수 있다.</strong></li>
  <li><strong>immutable 하다.</strong>
    <ul>
      <li>실행 중에 객체가 변하는 것을 막을 수 있다.</li>
      <li>오류를 사전에 방지할 수 있다.</li>
    </ul>
  </li>
</ul>

<h3 id="순환참조-오류의-방지">순환참조 오류의 방지</h3>
<p>개발을 하다보면 보통 여러 컴포넌트간의 의존성이 생긴다.<br />
그중에서도 A가 B를 참조하고, B가 다시 A를 참조하는 순환 참조도 발생할 수 있다.</p>

<p><strong>ex) 순환참조의 예</strong></p>
<pre><code class="language-java">@Service
public class MadPlayService {

    // 순환 참조
    @Autowired
    private MadLifeService madLifeService;

    public void sayMadPlay() {
        madLifeService.sayMadLife();
    }
}

@Service
public class MadLifeService {
    
    // 순환 참조
    @Autowired
    private MadPlayService madPlayService;

    public void sayMadLife() {
        madPlayService.sayMadPlay();
    }
}
</code></pre>
<p>다음과 같은 코드는 서로가 서로를 참조 하고있다.<br />
다음과 같이 <code>CommandLineRunner</code> 실험을 하면</p>
<pre><code class="language-java">@SpringBootApplication
public class DemoApplication implements CommandLineRunner {

    @Autowired
    private MadLifeService madLifeService;
    @Autowired
    private MadPlayService madPlayService;

    @Override
    public void run(String... args) {
        madPlayService.sayMadPlay();
        madLifeService.sayMadLife();
    }

    public static void main(String[] args) {
        SpringApplication.run(DemoApplication.class, args);
    }
}
</code></pre>
<p>구동은 정상적으로 되었지만 그 이후 run method 에서 실행을 하는 과정에서 에러가 생겼다.</p>
<pre><code class="language-java">java.lang.StackOverflowError: null
	at com.example.demo.GreetService.sayGreet(GreetService.java:12) ~[classes/:na]
	at com.example.demo.HelloService.sayHello(HelloService.java:12) ~[classes/:na]
	at com.example.demo.GreetService.sayGreet(GreetService.java:12) ~[classes/:na]
	at com.example.demo.HelloService.sayHello(HelloService.java:12) ~[classes/:na]
	at com.example.demo.GreetService.sayGreet(GreetService.java:12) ~[classes/:na]
</code></pre>
<p>즉 코드를 실행하기 전까지 오류가 발견되지 않는다는것이다.<br />
다음은 생성자 주입을 통한 Injection 이다.</p>

<pre><code class="language-java">@Service
public class MadPlayService {
    private final MadLifeService madLifeService;

    public MadPlayService(MadLifeService madLifeService) {
        this.madLifeService = madLifeService;
    }

    // 생략
}

@Service
public class MadLifeService {
    private final MadPlayService madPlayService;

    public MadLifeService(MadPlayService madPlayService) {
        this.madPlayService = madPlayService;
    }

    // 생략
}

</code></pre>
<p>실행결과는 <code>BeanCurrentlyInCreationException</code>이 발생하여 애플리케이션이 구동조차 되지 않는다.</p>
<pre><code class="language-java">Description:
The dependencies of some of the beans in the application context form a cycle:
┌─────┐
|  madLifeService defined in file [~~~/MadLifeService.class]
↑     ↓
|  madPlayService defined in file [~~~/MadPlayService.class]
└─────┘
</code></pre>
<p>실행결과의 차이가 나는이유는 생성자 주입 방법은 필드 주입이나 수정자 주입과는 빈을 주입하는 순서가 다르다.</p>

    </div>
    
    <footer class="post-footer">
        <div class="post-navigation">
            
            <div class="nav-previous">
                <span class="nav-label">이전 글</span>
                <a href="/cs/2022/03/19/adt-abstract-data-type/" class="nav-link">ADT - Abstract Data Type</a>
            </div>
            
            
            
            <div class="nav-next">
                <span class="nav-label">다음 글</span>
                <a href="/cs/2022/03/19/b-tree/" class="nav-link">B-Tree</a>
            </div>
            
        </div>
    </footer>
</article>

        </main>
    </div>

    <!-- Prism.js JavaScript 로드 (순서 중요!) -->
    <script src="/assets/js/prism/prism.min.js"></script>
    <script src="/assets/js/prism/prism-autoloader.min.js"></script>
    <script src="/assets/js/prism/prism-toolbar.min.js"></script>
    <script src="/assets/js/prism/prism-copy-to-clipboard.min.js"></script>
    <script src="/assets/js/prism/prism-show-language.min.js"></script>
    <script src="/assets/js/prism/prism-line-numbers.min.js"></script>

    <!-- Prism.js 초기화 스크립트 -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // autoloader 경로 설정 (로컬 컴포넌트 사용)
            if (Prism.plugins && Prism.plugins.autoloader) {
                Prism.plugins.autoloader.languages_path = '/assets/js/prism/components/';
                console.log('Prism autoloader configured with local path:', Prism.plugins.autoloader.languages_path);
            }
            
            // 모든 pre 태그에 toolbar와 line-numbers 클래스 추가
            document.querySelectorAll('pre[class*="language-"]').forEach(function(pre) {
                pre.classList.add('line-numbers');
            });
            
            // Prism 하이라이팅 재실행
            Prism.highlightAll();
        });
    </script>
    
    <!-- Command Palette (Ninja Keys) -->
    <script src="/assets/js/command-palette.js"></script>
    
    <!-- Category Sidebar Web Component -->
    <script src="/assets/js/category-sidebar.js"></script>
    
    <!-- Post Metadata Web Component -->
    <script src="/assets/js/post-metadata.js"></script>
</body>
</html>
