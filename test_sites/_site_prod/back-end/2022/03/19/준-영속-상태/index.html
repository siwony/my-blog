<!DOCTYPE html><html lang="ko"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>준 영속 상태</title><link rel="stylesheet" href="/assets/css/prism/prism-material-theme.css"><link rel="stylesheet" href="/assets/css/prism/prism-toolbar.min.css"><link rel="stylesheet" href="/assets/css/prism/prism-line-numbers.min.css"><link rel="stylesheet" href="/assets/css/style.css"><script type="module" src="https://unpkg.com/ninja-keys?module"></script></head><body><div class="container"><header><h1><a href="/">My Tech Blog</a></h1><nav><ul><li><a href="/">Home</a></li></ul></nav></header><main><article class="post"><header class="post-header"><h1 class="post-title">준 영속 상태</h1><post-metadata layout="inline" categories='["back-end"]' tags='["spring","jpa","TIL"]' date="March 19, 2022" reading-time="1" compact="false"></post-metadata><div class="post-author"><span class="author-label">작성자:</span> <span class="author-name">jeongcool</span></div></header><div class="post-content"><h1 id="준-영속-상태">준 영속 상태</h1><p>: <strong>영속 상태의 Entity가 영속성 컨텍스트에서 분리되는 것</strong></p><ul><li>영속에서 준 영속으로 바뀌는 상태</li><li>준 영속상태에서는 영속성 컨텍스트가 제공하는 기능을 사용할 수 없다.</li></ul><blockquote><p>앞으로 예제 코드는 다음을 생략한다.</p><pre><code class="language-java"> EntityManager em = emf.createEntityManager();
 EntityTransaction transaction = em.getTransaction();
 transaction.begin(); // [트랜잭션] 시작
...
 //(예제 코드 ...)
...
tx.commit();
</code></pre></blockquote><h3 id="준-영속-방법">준 영속 방법</h3><h4 id="1-emdetach영속된-엔티티-객체">1. <code>em.detach(영속된 엔티티 객체)</code></h4><p>: 특정 <code>Entity</code>만 준 영속상태로 바꾼다.</p><pre><code class="language-java">  Member member = em.find(Member.class, 150L); 
  member.setName("siwony_");  

  em.detach(member); //준영속

  tx.commit();  // insert 쿼리문이 날아가지 않는다.
</code></pre><ul><li><code>selete</code> 쿼리만 날아가고 <code>insert</code> 쿼리는 날아가지 않는다.</li><li>즉, 영속성 컨텍스트의 기능인 변경 감지(Dirty check)가 작동하지 않는다.</li></ul><h4 id="2emclear">2.<code>em.clear()</code></h4><p>: 영속성 컨텍스트를 완전히 초기화 한다.</p><pre><code class="language-java">
  Member member = em.find(Member.class, 150L); //select 쿼리 나감
  member.setName("siwony_");  

  em.clear(); //영속성 컨텍스트를 초기화 한다.

  Member member2 = em.find(Member.class, 150L); //select 쿼리 나감
  tx.commit(); 
</code></pre><p>중간에 한번 <code>em.clear();</code>를 했기 때문에 select 쿼리가 두 번 나간다.</p><blockquote><p>test code를 작성할 때 유용하다.</p></blockquote><h4 id="emclose"><code>em.close</code></h4><p>: <strong>영속성 컨텍스트를 종료한다.</strong></p></div><footer class="post-footer"><div class="post-navigation"><div class="nav-previous"><span class="nav-label">이전 글</span> <a href="/back-end/2022/03/19/%EC%A0%95%EB%A6%AC/" class="nav-link">정리</a></div><div class="nav-next"><span class="nav-label">다음 글</span> <a href="/cs/2022/03/19/%EC%BA%90%EC%8B%9C-%EB%A9%94%EB%AA%A8%EB%A6%AC-cache-memory/" class="nav-link">캐시 메모리 - Cache Memory</a></div></div></footer></article></main></div><script src="/assets/js/prism/prism.min.js"></script><script src="/assets/js/prism/prism-autoloader.min.js"></script><script src="/assets/js/prism/prism-toolbar.min.js"></script><script src="/assets/js/prism/prism-copy-to-clipboard.min.js"></script><script src="/assets/js/prism/prism-show-language.min.js"></script><script src="/assets/js/prism/prism-line-numbers.min.js"></script><script>document.addEventListener("DOMContentLoaded",function(){Prism.plugins&&Prism.plugins.autoloader&&(Prism.plugins.autoloader.languages_path="/assets/js/prism/components/",console.log("Prism autoloader configured with local path:",Prism.plugins.autoloader.languages_path)),document.querySelectorAll('pre[class*="language-"]').forEach(function(s){s.classList.add("line-numbers")}),Prism.highlightAll()})</script><script src="/assets/js/command-palette.js"></script><script src="/assets/js/category-sidebar.js"></script><script src="/assets/js/post-metadata.js"></script></body></html>