<!DOCTYPE html><html lang="ko"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>sequelize</title><link rel="stylesheet" href="/assets/css/prism/prism-material-theme.css"><link rel="stylesheet" href="/assets/css/prism/prism-toolbar.min.css"><link rel="stylesheet" href="/assets/css/prism/prism-line-numbers.min.css"><link rel="stylesheet" href="/assets/css/style.css"><script type="module" src="https://unpkg.com/ninja-keys?module"></script></head><body><div class="container"><header><h1><a href="/">My Tech Blog</a></h1><nav><ul><li><a href="/">Home</a></li></ul></nav></header><main><article class="post"><header class="post-header"><h1 class="post-title">sequelize</h1><post-metadata layout="inline" categories='["back-end"]' tags='["nodejs","TIL"]' date="March 19, 2022" reading-time="3" compact="false"></post-metadata><div class="post-author"><span class="author-label">작성자:</span> <span class="author-name">jeongcool</span></div></header><div class="post-content"><h1 id="sequelize">sequelize</h1><p>: node.js 의 ORM(Object Releaition Mapping) 모듈이다.</p><h3 id="how-to-use">how to use?</h3><pre><code class="language-bash">npm install sequelize sequelize-cli
</code></pre><p>위 명령어를 통해 sequelize 모듈과 sequelize-cli 모듈을 받아온다.<br>sequelize-cli는 cli로 모델을 쉽게 생성할 수 있다.<br><strong>다음 명령어를 통해 초기화를 한다.</strong></p><pre><code class="language-bash">&gt; sequelize init
</code></pre><p>root 디렉토리에 아래와같은 디렉토리/파일이 생긴다.<br><strong>여기서 root 디렉토리는 현제 작업하고있는 프로젝트의 최상위 디렉토리</strong>를 말한다.<br>예시로 <code>npm init</code>으로 초기화한 디렉토리를 말한다.</p><pre><code class="language-bash">|-- config
|   `-- config.json
|-- migrations     
|-- models
|   `-- index.js   
|-- seeders        
</code></pre><h3 id="sequelize-디렉토리별-정의">sequelize 디렉토리별 정의</h3><ul><li><strong>config</strong> : DB설정파일, 사용자이름, DB이름, 비밀번호 등이 들어가 있다.</li><li><strong>migrations</strong> : Git과 비슷하게 DB변화하는 과정을 추측해나아가는 정보로 실제 DB에 반영할 수 있고 취소할 수 있다.</li><li><strong>models</strong> : DB 각 테이블의 정보 및 필드타입을 정의하고 하나로 모은다.</li><li><strong>seeders</strong> : table에 기본 데이터를 넣고싶을때 사용한다.<h3 id="디렉토리를-정리해보자">디렉토리를 정리해보자</h3><p>root에는 너무많은 디렉토리, 소스코드, 설정파일들이 있다<br>우리는 저 많은 디렉토리들을 하나의 디렉토리로 정리하여 묶을 필요가 있다.<br>먼저 위에서 생성했던 파일들을 제거하자. 그리고 <strong><code>.sequelizerc</code></strong> 파일을 프로젝트 최상위에 생성한다.<br>그후 <strong><code>.sequelizerc</code></strong> 파일을 아래와 같이 작성한다.<br>```JavaScript // .sequelizerc const path = require(‘path’);</p></li></ul><p>module.exports = { ‘config’: path.resolve(‘src/db/config/config.json’), ‘models-path’: path.resolve(‘src/db/models’), ‘seeders-path’: path.resolve(‘src/db/seeders’), ‘migrations-path’: path.resolve(‘src/db/migrations’) }</p><pre><code>`sequelize init` 를 통해 초기화하면 root에 **`/src/db`** 경로로 sequelize 구성 파일과 디렉토리가
### 설정
`config/config.json` 에 들어가면 json 형식으로 DB 정보가 작성되어있을것이다. 
```JavaScript
{
  "development": {
    "username": "root",
    "password": null,
    "database": "database_development",
    "host": "127.0.0.1",
    "dialect": "mysql"
  },
  "test": {
    "username": "root",
    "password": null,
    "database": "database_test",
    "host": "127.0.0.1",
    "dialect": "mysql"
  },
  "production": {
    "username": "root",
    "password": null,
    "database": "database_production",
    "host": "127.0.0.1",
    "dialect": "mysql"
  }
}
</code></pre><p>처음으로 sequelize를 초기화 했으면 기본적으로 <code>development</code>에 입력되어있는 DB정보로 개발이 이루어 질것이다.<br>자신이 설정한 mysql DB에 따라 정보를 수정한다. 개발을 할것이기에 <code>development</code> 에 있는 정보를 수정하자 <strong>참고로 password는 String 형으로 받아야 된다 그러므로 큰따음표(“)로 묶어줘야한다.</strong><br>안그러면 <code>ERR_INVALID_ARG_TYPE</code> 에러가 발생할것이다<br><del>필자는 비밀번호가 1234였는데 비밀번호를 큰따음표(“)로 안묶어서 에러때문에 2시간동안 고생했다</del></p><h2 id="db모델링">DB모델링</h2><p>간단하게 User라는 table 모델을 만들게되면</p><pre><code class="language-bash">sequelize model:generate --name User --attributes id:integer, name:string
</code></pre><p><code>model/user.js</code>가 아래처럼 만들어진다. (2020, 12, 20 기준)</p><pre><code class="language-javascript">'use strict';
const {
  Model
} = require('sequelize');
module.exports = (sequelize, DataTypes) =&gt; {
  class User extends Model {
    /**
     * Helper method for defining associations.
     * This method is not a part of Sequelize lifecycle.
     * The `models/index` file will call this method automatically.
     */
    static associate(models) {
      // define association here
    }
  };
  User.init({
    id: DataTypes.INTEGER,
    name: DataTypes.STRING
  }, {
    sequelize,
    modelName: 'User',
  });
  return User;
};
</code></pre><p>이렇게 <code>user.js</code> 라는 파일이 <code>model</code> 디렉토리 안에 생기고, Users 라는 테이블이 생기는데<br><em>Users로 모델이 생성된 이유는 기본적으로 sequelize에서 자동으로 첫글자는 대문자, 복수형 로 변환해준다.</em></p><h3 id="if모델을-수정했다면">if모델을 수정했다면</h3><pre><code class="language-bash">&gt; sequelize db:migrations
</code></pre><p>이 명령어를 꼭 입력해줘야한다, 이유는 모델이 수정이 되도 최종적으로 DB에 반영하는것은<br>migrations 폴더 안에있는 <code>[타임스탬프]-create-user.js</code>형식의 파일이다.</p><h2 id="db모델-반영">DB모델 반영</h2><blockquote><p>server를 실행할 파일에 <code>models/index.js</code>를 연결해주면 설계한대로 반영이 될것이다.</p></blockquote><p><strong>참고</strong></p><ul><li>자동으로 생기는 attribute: id, createdAt, updatedAt</li></ul></div><footer class="post-footer"><div class="post-navigation"><div class="nav-previous"><span class="nav-label">이전 글</span> <a href="/back-end/2022/03/19/remote-host-identification-has-changed-error/" class="nav-link">REMOTE HOST IDENTIFICATION HAS CHANGED Error</a></div><div class="nav-next"><span class="nav-label">다음 글</span> <a href="/back-end/2022/03/19/servlet/" class="nav-link">Servlet</a></div></div></footer></article></main></div><script src="/assets/js/prism/prism.min.js"></script><script src="/assets/js/prism/prism-autoloader.min.js"></script><script src="/assets/js/prism/prism-toolbar.min.js"></script><script src="/assets/js/prism/prism-copy-to-clipboard.min.js"></script><script src="/assets/js/prism/prism-show-language.min.js"></script><script src="/assets/js/prism/prism-line-numbers.min.js"></script><script>document.addEventListener("DOMContentLoaded",function(){Prism.plugins&&Prism.plugins.autoloader&&(Prism.plugins.autoloader.languages_path="/assets/js/prism/components/",console.log("Prism autoloader configured with local path:",Prism.plugins.autoloader.languages_path)),document.querySelectorAll('pre[class*="language-"]').forEach(function(s){s.classList.add("line-numbers")}),Prism.highlightAll()})</script><script src="/assets/js/command-palette.js"></script><script src="/assets/js/category-sidebar.js"></script><script src="/assets/js/post-metadata.js"></script></body></html>