<!DOCTYPE html><html lang="ko"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>CORS 문제 해결</title><link rel="stylesheet" href="/assets/css/prism/prism-material-theme.css"><link rel="stylesheet" href="/assets/css/prism/prism-toolbar.min.css"><link rel="stylesheet" href="/assets/css/prism/prism-line-numbers.min.css"><link rel="stylesheet" href="/assets/css/style.css"><script type="module" src="https://unpkg.com/ninja-keys?module"></script></head><body><div class="container"><header><h1><a href="/">My Tech Blog</a></h1><nav><ul><li><a href="/">Home</a></li></ul></nav></header><main><article class="post"><header class="post-header"><h1 class="post-title">CORS 문제 해결</h1><post-metadata layout="inline" categories='["back-end"]' tags='["spring-boot","spring","TIL"]' date="March 19, 2022" reading-time="1" compact="false"></post-metadata><div class="post-author"><span class="author-label">작성자:</span> <span class="author-name">jeongcool</span></div></header><div class="post-content"><h1 id="cors-문제-해결">CORS 문제 해결</h1><blockquote><p>the moment(학교가 불편한 순간) 프로젝트에서 협업 도중생긴 CORS이슈<br>여기는 CORS에 대해 다룹니다.</p><h2 id="cors란">CORS란?</h2><p>: <code>Cross-Origin Resource Sharing(교차 출처 리소스 공유)</code> 의 약자로<br>브라우저에서 실행 중인 스프립트에서 시작되는 <code>cross-origin HTTP</code> 요청을 제한하는 브라우저 보안 기능이다.</p></blockquote><p>브라우저는 <code>same-origin policy(동일 출처 정책)</code>에 의해 <code>cross-origin</code>의 리소스를 요청을 차단한다.</p><h3 id="cross-origin-종류">cross-origin 종류</h3><ul><li>다른 도메인 (ex. <code>foo.com</code> → <code>example.com</code>)</li><li>다른 하위 도메인 (ex. <code>google.com</code> → <code>docs.google.com</code>)</li><li>다른 포트 (ex. <code>foo.com</code> → <code>foo.com:800</code>)</li><li>다른 프로토콜 (ex. <code>https://foo.com</code> → <code>http://foo.com</code>)</li></ul><h2 id="해결방안">해결방안</h2><p>제일 쉬운 해결방안은 서버 단에서 특정 <code>origin</code> 혹은 <code>모든 origin</code> 을 허용하도록 설정 하면 된다.</p><p><code>WebMvcConfigurer</code> 를 상속받은 <code>WebConfig</code>를 다음과 같이 작성한다.</p><pre><code class="language-java">@Configuration
public class WebMvcConfig implements WebMvcConfigurer {
    @Override
    public void addCorsMappings(CorsRegistry registry) {
        registry.addMapping("/**") // 모든 요청에 대해서 허용
                // http://localhost:8080, http://localhost:5000 에서 들어오는 요청을 허용한다.
                .allowedOrigins("http://localhost:8080", "http://localhost:5000") 
}
</code></pre><p>하지만 여기에서 끝나면 <code>GET</code>, <code>POST</code> 요청은 정상적으로 요청이 되지만<br><code>HEAD</code>, <code>PUT</code>, <code>DELETE</code> HTTP method에 대해서는 CORS가 발생한다.</p><p>SpringBoot 에서는 <code>allowedOrigins</code> 를 통해 CORS허용을 하면 기본적으로 GET, POST, HEAD 만 허용을 해준다.<br>따라서 <code>allowedMethods</code>를 이용해 허용할 HTTP Method를 추가해준다.</p><pre><code class="language-java">@Override
public void addCorsMappings(CorsRegistry registry) {
    registry.addMapping("/**") // 모든 요청에 대해서
            .allowedOrigins("http://localhost:8080", "http://localhost:5000", "**") // local, docker
            .allowedMethods(
                    HttpMethod.GET.name(),
                    HttpMethod.HEAD.name(),
                    HttpMethod.POST.name(),
                    HttpMethod.PUT.name(),
                    HttpMethod.DELETE.name()
            )
        ;
}
</code></pre></div><footer class="post-footer"><div class="post-navigation"><div class="nav-previous"><span class="nav-label">이전 글</span> <a href="/back-end/2022/03/19/cascade%EC%98%81%EC%86%8D%EC%84%B1-%EC%A0%84%EC%9D%B4/" class="nav-link">CASCADE(영속성 전이)</a></div><div class="nav-next"><span class="nav-label">다음 글</span> <a href="/back-end/2022/03/19/cross-site-request-forgery-%EC%82%AC%EC%9D%B4%ED%8A%B8%EA%B0%84-%EC%9A%94%EC%B2%AD-%EC%9C%84%EC%A1%B0/" class="nav-link">Cross Site Request Forgery, 사이트간 요청 위조)</a></div></div></footer></article></main></div><script src="/assets/js/prism/prism.min.js"></script><script src="/assets/js/prism/prism-autoloader.min.js"></script><script src="/assets/js/prism/prism-toolbar.min.js"></script><script src="/assets/js/prism/prism-copy-to-clipboard.min.js"></script><script src="/assets/js/prism/prism-show-language.min.js"></script><script src="/assets/js/prism/prism-line-numbers.min.js"></script><script>document.addEventListener("DOMContentLoaded",function(){Prism.plugins&&Prism.plugins.autoloader&&(Prism.plugins.autoloader.languages_path="/assets/js/prism/components/",console.log("Prism autoloader configured with local path:",Prism.plugins.autoloader.languages_path)),document.querySelectorAll('pre[class*="language-"]').forEach(function(s){s.classList.add("line-numbers")}),Prism.highlightAll()})</script><script src="/assets/js/command-palette.js"></script><script src="/assets/js/category-sidebar.js"></script><script src="/assets/js/post-metadata.js"></script></body></html>